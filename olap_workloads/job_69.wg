SELECT t.title, COUNT(DISTINCT mk.keyword_id) AS num_keywords, AVG(ci.nr_order) AS avg_order FROM title t JOIN movie_keyword mk ON t.id = mk.movie_id JOIN cast_info ci ON t.id = ci.movie_id WHERE t.production_year BETWEEN 2000 AND 2020 AND mk.keyword_id IN (43, 2202, 17147) GROUP BY t.title HAVING COUNT(DISTINCT mk.keyword_id) > 1 ORDER BY num_keywords DESC, avg_order ASC;
SELECT n.name, COUNT(DISTINCT ml.link_type_id) AS num_links, COUNT(DISTINCT ci.movie_id) AS num_movies FROM name n JOIN cast_info ci ON n.id = ci.person_id JOIN movie_link ml ON ci.movie_id = ml.movie_id WHERE ml.link_type_id IN (7, 11, 17) AND n.gender = 'M' GROUP BY n.name HAVING COUNT(DISTINCT ml.link_type_id) > 1 AND COUNT(DISTINCT ci.movie_id) > 5 ORDER BY num_links DESC, num_movies DESC;
SELECT it.info, COUNT(DISTINCT pi.person_id) AS num_people, AVG(pi.note::integer) AS avg_note FROM info_type it JOIN person_info pi ON it.id = pi.info_type_id WHERE pi.info_type_id IN (35, 20, 27) AND pi.note IS NOT NULL GROUP BY it.info HAVING COUNT(DISTINCT pi.person_id) > 10 ORDER BY avg_note DESC, num_people DESC;