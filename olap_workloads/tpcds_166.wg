SELECT s.s_state, COUNT(ss.ss_ticket_number) AS total_sales, AVG(ss.ss_sales_price) AS avg_sales_price FROM store_sales ss JOIN store s ON ss.ss_store_sk = s.s_store_sk WHERE ss.ss_sales_price > 100 GROUP BY s.s_state HAVING COUNT(ss.ss_ticket_number) > 1000 ORDER BY total_sales DESC, s.s_state ASC;
SELECT ws.ws_web_site_sk, w.web_name, SUM(ws.ws_net_profit) AS total_net_profit FROM web_sales ws JOIN web_site w ON ws.ws_web_site_sk = w.web_site_sk WHERE ws.ws_sold_date_sk IN (SELECT d_date_sk FROM date_dim WHERE d_year = 2021 AND d_qoy = 1) GROUP BY ws.ws_web_site_sk, w.web_name HAVING SUM(ws.ws_net_profit) > 100000 ORDER BY total_net_profit DESC;