SELECT c.c_name, c.c_phone, SUM(o.o_totalprice) AS total_spent, AVG(o.o_totalprice) AS avg_spent, COUNT(o.o_orderkey) AS num_orders FROM customer c JOIN orders o ON c.c_custkey = o.o_custkey WHERE c.c_nationkey IN (17, 8, 12) AND o.o_orderdate BETWEEN '1993-09-29' AND '1995-05-20' GROUP BY c.c_name, c.c_phone HAVING COUNT(o.o_orderkey) > 5 ORDER BY total_spent DESC, c.c_name ASC;
SELECT p.p_brand, p.p_size, p.p_mfgr, COUNT(l.l_orderkey) AS num_orders, SUM(l.l_extendedprice * (1 - l.l_discount)) AS revenue FROM part p JOIN lineitem l ON p.p_partkey = l.l_partkey JOIN supplier s ON l.l_suppkey = s.s_suppkey JOIN orders o ON l.l_orderkey = o.o_orderkey WHERE p.p_brand IN ('Brand#52', 'Brand#35', 'Brand#25') AND p.p_size IN (26, 16, 29) AND s.s_suppkey IN (306, 117, 160) AND o.o_orderdate < '1994-04-27' GROUP BY p.p_brand, p.p_size, p.p_mfgr HAVING COUNT(l.l_orderkey) > 10 ORDER BY revenue DESC, p.p_brand ASC, p.p_size ASC;