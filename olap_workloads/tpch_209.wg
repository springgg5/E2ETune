SELECT r.r_name, n.n_name, COUNT(o.o_orderkey) AS order_count, AVG(o.o_totalprice) AS avg_order_price FROM region r JOIN nation n ON r.r_regionkey = n.n_regionkey JOIN customer c ON n.n_nationkey = c.c_nationkey JOIN orders o ON c.c_custkey = o.o_custkey WHERE r.r_comment LIKE '3PO%' AND o.o_orderpriority = '1-URGENT' GROUP BY r.r_name, n.n_name ORDER BY order_count DESC, avg_order_price DESC;
SELECT p.p_type, p.p_container, SUM(l.l_quantity) AS total_quantity, COUNT(DISTINCT l.l_orderkey) AS distinct_orders FROM part p JOIN lineitem l ON p.p_partkey = l.l_partkey JOIN orders o ON l.l_orderkey = o.o_orderkey WHERE p.p_size BETWEEN 28 AND 49 AND l.l_shipmode IN ('AIR', 'FOB') AND o.o_orderdate BETWEEN '2021-01-01' AND '2021-12-31' GROUP BY p.p_type, p.p_container HAVING SUM(l.l_quantity) > 1000 ORDER BY total_quantity DESC, distinct_orders DESC;