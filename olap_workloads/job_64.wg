SELECT lt.link, COUNT(DISTINCT ml.movie_id) AS movie_count, COUNT(DISTINCT ml.linked_movie_id) AS linked_movie_count FROM link_type lt JOIN movie_link ml ON lt.id = ml.link_type_id WHERE lt.id IN (13, 12, 8) GROUP BY lt.link HAVING COUNT(DISTINCT ml.movie_id) > 10 AND COUNT(DISTINCT ml.linked_movie_id) > 10 ORDER BY movie_count DESC, linked_movie_count DESC;
SELECT it.info, COUNT(DISTINCT mc.movie_id) AS movie_count, COUNT(DISTINCT mc.company_id) AS company_count, AVG(mc.company_type_id) AS avg_company_type_id FROM info_type it JOIN movie_info mi ON it.id = mi.info_type_id JOIN movie_companies mc ON mi.movie_id = mc.movie_id WHERE it.id IN (98, 47, 18) AND mc.note IN ('(2008) (Japan) (TV)', '(2002) (UK) (DVD)', '(2006) (Canada) (TV)') GROUP BY it.info HAVING COUNT(DISTINCT mc.movie_id) > 5 AND COUNT(DISTINCT mc.company_id) > 5 ORDER BY movie_count DESC, company_count DESC, avg_company_type_id ASC;