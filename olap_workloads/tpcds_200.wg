SELECT w_state, SUM(inv_quantity_on_hand) AS total_inventory FROM inventory INNER JOIN warehouse ON inv_warehouse_sk = w_warehouse_sk GROUP BY w_state ORDER BY total_inventory DESC;
WITH customer_summary AS (SELECT c_customer_sk, COUNT(ss_ticket_number) AS num_tickets, SUM(ss_sales_price) AS total_sales FROM customer_demographics cd INNER JOIN customer c ON cd.cd_demo_sk = c.c_current_cdemo_sk INNER JOIN store_sales ss ON c.c_customer_sk = ss.ss_customer_sk WHERE cd.cd_credit_rating = 'Good' AND cd.cd_marital_status IN ('S', 'D', 'U') AND cd.cd_dep_college_count = 0 AND cd.cd_dep_employed_count = 0 GROUP BY c_customer_sk) SELECT c_salutation, c_first_name, c_last_name, cs.num_tickets, cs.total_sales FROM customer_summary cs INNER JOIN customer c ON cs.c_customer_sk = c.c_customer_sk WHERE cs.total_sales > (SELECT AVG(total_sales) FROM customer_summary) ORDER BY cs.total_sales DESC;